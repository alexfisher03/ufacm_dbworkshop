<!doctype html>
<meta charset="utf-8" />
<title>DB Workshop — Minimal Demo</title>
<body style="font-family: system-ui, sans-serif; margin: 24px auto; max-width: 720px; color:#0b1220;">
  <!-- Header shows API base and active backend pulled from /api/info -->
  <header style="display:flex; align-items:center; justify-content:space-between; gap:12px; padding-bottom:12px; border-bottom:1px solid #e5e7eb;">
    <div>
      <h1 style="margin:0;">DB Workshop — Minimal Demo</h1>
      <div style="color:#6b7280; font-size:14px;">
        API: <code>http://localhost:3001</code> • Backend: <code id="store">?</code>
      </div>
    </div>
  </header>

  <!-- Three buttons = three endpoints -->
  <section style="display:grid; gap:16px; margin-top:16px;">
    <div class="card">
      <h2 style="margin:0 0 8px 0;">Quick Actions</h2>
      <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:end;">
        <button id="btnLoadProducts" class="btn">GET /products</button>
        <button id="btnFetchAll" class="btn">GET /orders/all</button>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px 0;">Create Order (POST /orders)</h2>
      <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:end;">
        <label>Customer<br/><input id="customer" value="Alex" class="inp"></label>
        <label>Product ID<br/><input id="pid" type="number" value="1" min="1" class="inp"></label>
        <label>Qty<br/><input id="qty" type="number" value="2" min="1" class="inp"></label>
        <button id="btnCreate" class="btn">POST /orders</button>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px 0;">Output</h2>
      <pre id="out" class="out"></pre>
    </div>
  </section>

  <style>
    .card { border:1px solid #e5e7eb; border-radius:12px; padding:16px; background:#fff; }
    .btn { padding:8px 12px; border-radius:10px; border:1px solid #d1d5db; background:#f9fafb; cursor:pointer; }
    .btn:hover { background:#eef2ff; border-color:#c7d2fe; }
    .inp { padding:8px 10px; border:1px solid #d1d5db; border-radius:8px; min-width: 120px; }
    .out { background:#0b1220; color:#e5e7eb; padding:12px; border-radius:8px; min-height:120px; white-space:pre-wrap; }
  </style>

  <script>
    const api = 'http://localhost:3001/api';
    const $ = s => document.querySelector(s);
    const cents = n => (n/100).toFixed(2);
    const log = msg => { const el=$('#out'); el.textContent += (el.textContent?'\n':'') + msg; el.scrollTop=el.scrollHeight; };

    (async () => {
      try { const info = await fetch(`${api.replace('/api','')}/api/info`).then(r=>r.json()); $('#store').textContent = info.store; } catch {}
    })();

    // GET /products
    $('#btnLoadProducts').onclick = async () => {
      try {
        const rows = await fetch(`${api}/products`).then(r => r.json());
        const lines = rows.map(p => `#${p.id} ${p.name} — $${cents(p.price_cents)}`).join('\n');
        log(lines || '(no products)');
      } catch { log('GET /products failed.'); }
    };

    // POST /orders
    $('#btnCreate').onclick = async () => {
      const body = {
        customer: $('#customer').value,
        items: [{ productId: Number($('#pid').value), qty: Number($('#qty').value) }]
      };
      try {
        const res = await fetch(`${api}/orders`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(body)
        }).then(r => r.json());
        log('Created order: ' + JSON.stringify(res));
      } catch { log('POST /orders failed.'); }
    };

    // GET /orders/all
    $('#btnFetchAll').onclick = async () => {
      try {
        const orders = await fetch(`${api}/orders/all`).then(r => r.json());
        log('All orders:\n' + JSON.stringify(orders, null, 2));
      } catch { log('GET /orders/all failed.'); }
    };
  </script>
</body>
